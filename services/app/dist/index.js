(()=>{"use strict";var e={280:(e,t)=>{var r;Object.defineProperty(t,"__esModule",{value:!0});var n={server:{port:null!==(r=process.env.PORT)&&void 0!==r?r:3001,cors:{origin:"http://localhost:3000"}}};t.default=n},955:function(e,t,r){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.rolesRepository=t.projectsQueryService=t.projectsRepository=t.authRepository=void 0;var o=r(896),i=n(r(784)),u=n(r(155)),a=n(r(463)),s=n(r(874));o.container.register("authRepository",{useClass:i.default}),o.container.register("projectsRepository",{useClass:a.default}),o.container.register("projectsQueryService",{useClass:u.default}),o.container.register("rolesRepository",{useClass:s.default}),t.authRepository=o.container.resolve("authRepository"),t.projectsRepository=o.container.resolve("projectsRepository"),t.projectsQueryService=o.container.resolve("projectsQueryService"),t.rolesRepository=o.container.resolve("rolesRepository")},536:function(e,t,r){var n=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))((function(o,i){function u(e){try{s(n.next(e))}catch(e){i(e)}}function a(e){try{s(n.throw(e))}catch(e){i(e)}}function s(e){var t;e.done?o(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(u,a)}s((n=n.apply(e,t||[])).next())}))},o=this&&this.__generator||function(e,t){var r,n,o,i,u={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(i){return function(a){return function(i){if(r)throw new TypeError("Generator is already executing.");for(;u;)try{if(r=1,n&&(o=2&i[0]?n.return:i[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,i[1])).done)return o;switch(n=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return u.label++,{value:i[1],done:!1};case 5:u.label++,n=i[1],i=[0];continue;case 7:i=u.ops.pop(),u.trys.pop();continue;default:if(!((o=(o=u.trys).length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){u=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){u.label=i[1];break}if(6===i[0]&&u.label<o[1]){u.label=o[1],o=i;break}if(o&&u.label<o[2]){u.label=o[2],u.ops.push(i);break}o[2]&&u.ops.pop(),u.trys.pop();continue}i=t.call(e,u)}catch(e){i=[6,e],n=0}finally{r=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,a])}}},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var u=i(r(807)),a=i(r(12)),s=i(r(382)),c=r(818),l=r(955);t.default=function(){return{signup:function(e,t,r){return n(void 0,void 0,void 0,(function(){return o(this,(function(i){return n(void 0,void 0,void 0,(function(){var r,n,i,c,f,d;return o(this,(function(o){switch(o.label){case 0:return r=e.body,n=r.email,i=r.password,c=r.nickname,f=a.default.create(c),d=s.default.create(n,i),[4,l.authRepository.loginByEmail(d.email)];case 1:if(o.sent())throw new u.default("既に登録されているメールアドレスです");return[4,l.authRepository.signupByEmail(f,d)];case 2:return o.sent(),t.status(200).end(),[2]}}))})).catch(r),[2]}))}))},login:function(e,t){if(!e.user)throw new u.default("認証に失敗しました",401);var r=(0,c.signToken)(e.user);t.status(200).send({id:e.user.id,token:r})}}}},533:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t,r){this._id=e,this._identifier=t,this._credential=r}return Object.defineProperty(e.prototype,"id",{get:function(){if(!this._id.isGenerated)throw new Error("IDが生成されていません");return this._id},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"identifier",{get:function(){return this._identifier},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"credential",{get:function(){return this._credential},enumerable:!1,configurable:!0}),e.prototype.setId=function(t){return new e(t,this._identifier,this._credential)},e}();t.default=r},382:function(e,t,r){var n,o=this&&this.__extends||(n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])},n(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var u=i(r(533)),a=i(r(332)),s=i(r(970)),c=r(701),l=function(e){function t(t,r){return e.call(this,c.NoneId.instance,t,r)||this}return o(t,e),t.create=function(e,r){var n=a.default.create(e),o=s.default.create(r);return new t(n.value,o.encrepted)},Object.defineProperty(t.prototype,"email",{get:function(){return this.identifier},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"password",{get:function(){return this.credential},enumerable:!1,configurable:!0}),t}(u.default);t.default=l},332:function(e,t,r){var n,o=this&&this.__extends||(n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])},n(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var u=i(r(596)),a=i(r(807)),s=function(e){function t(t){return e.call(this,t)||this}return o(t,e),t.create=function(e){if(!/^[a-zA-Z0-9_.+-]+@([a-zA-Z0-9][a-zA-Z0-9-]*[a-zA-Z0-9]*\.)+[a-zA-Z]{2,}$/.test(e))throw new a.default("メールアドレスの形式を確認してください",400);return new t(e)},t}(u.default);t.default=s},12:function(e,t,r){var n,o=this&&this.__extends||(n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])},n(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var u=i(r(596)),a=i(r(807)),s=function(e){function t(t){return e.call(this,t)||this}return o(t,e),t.create=function(e){if(e.length<3||e.length>255)throw new a.default("ニックネームは3文字以上255文字以下で入力してください");return new t(e)},t}(u.default);t.default=s},970:function(e,t,r){var n,o=this&&this.__extends||(n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])},n(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var u=i(r(596)),a=i(r(807)),s=r(482),c=function(e){function t(t){return e.call(this,t)||this}return o(t,e),t.create=function(e){if(e.length<5||e.length>255)throw new a.default("パスワードは5文字以上255文字以下で入力してください",400);return new t(e)},Object.defineProperty(t.prototype,"encrepted",{get:function(){return(0,s.hashSync)(this._value)},enumerable:!1,configurable:!0}),t}(u.default);t.default=c},402:function(e,t,r){var n,o,i=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))((function(o,i){function u(e){try{s(n.next(e))}catch(e){i(e)}}function a(e){try{s(n.throw(e))}catch(e){i(e)}}function s(e){var t;e.done?o(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(u,a)}s((n=n.apply(e,t||[])).next())}))},u=this&&this.__generator||function(e,t){var r,n,o,i,u={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(i){return function(a){return function(i){if(r)throw new TypeError("Generator is already executing.");for(;u;)try{if(r=1,n&&(o=2&i[0]?n.return:i[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,i[1])).done)return o;switch(n=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return u.label++,{value:i[1],done:!1};case 5:u.label++,n=i[1],i=[0];continue;case 7:i=u.ops.pop(),u.trys.pop();continue;default:if(!((o=(o=u.trys).length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){u=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){u.label=i[1];break}if(6===i[0]&&u.label<o[1]){u.label=o[1],o=i;break}if(o&&u.label<o[2]){u.label=o[2],u.ops.push(i);break}o[2]&&u.ops.pop(),u.trys.pop();continue}i=t.call(e,u)}catch(e){i=[6,e],n=0}finally{r=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,a])}}},a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var s=a(r(511)),c=a(r(807)),l=r(518),f=r(136),d=r(253),p=r(818),h=r(482),_=r(955);s.default.use(new l.Strategy({usernameField:"email",passwordField:"password",session:!1},(function(e,t,r){return i(void 0,void 0,void 0,(function(){var n,o;return u(this,(function(i){switch(i.label){case 0:return i.trys.push([0,2,,3]),[4,_.authRepository.loginByEmail(e)];case 1:return(n=i.sent())&&(0,h.compareSync)(t,n.credential)?[2,r(null,{id:n.id.value})]:[2,r(new c.default("メールアドレスまたはパスワードが誤っています",401))];case 2:return o=i.sent(),[2,r(o)];case 3:return[2]}}))}))})));var v={jwtFromRequest:f.ExtractJwt.fromAuthHeaderAsBearerToken(),secretOrKey:p.JWT_SECRET_KEY};s.default.use(new f.Strategy(v,(function(e,t){t(null,e)}))),s.default.use(new d.Strategy({clientID:null!==(n=process.env.GITHUB_CLIENT_ID)&&void 0!==n?n:"INVALID_CLIENT_ID",clientSecret:null!==(o=process.env.GITHUB_CLIENT_SECRET)&&void 0!==o?o:"INVALID_CLIENT_SECRET",callbackURL:"http://localhost:3001/api/v1/auth/github/callback"},(function(e,t,r,n){return i(void 0,void 0,void 0,(function(){var t,o;return u(this,(function(i){switch(i.label){case 0:return i.trys.push([0,2,,3]),[4,_.authRepository.authByGithub(r.username,r.id,e)];case 1:return t=i.sent(),[2,n(null,{id:t.id.value})];case 2:return o=i.sent(),[2,n(o)];case 3:return[2]}}))}))}))),t.default=s.default},784:function(e,t,r){var n=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))((function(o,i){function u(e){try{s(n.next(e))}catch(e){i(e)}}function a(e){try{s(n.throw(e))}catch(e){i(e)}}function s(e){var t;e.done?o(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(u,a)}s((n=n.apply(e,t||[])).next())}))},o=this&&this.__generator||function(e,t){var r,n,o,i,u={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(i){return function(a){return function(i){if(r)throw new TypeError("Generator is already executing.");for(;u;)try{if(r=1,n&&(o=2&i[0]?n.return:i[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,i[1])).done)return o;switch(n=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return u.label++,{value:i[1],done:!1};case 5:u.label++,n=i[1],i=[0];continue;case 7:i=u.ops.pop(),u.trys.pop();continue;default:if(!((o=(o=u.trys).length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){u=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){u.label=i[1];break}if(6===i[0]&&u.label<o[1]){u.label=o[1],o=i;break}if(o&&u.label<o[2]){u.label=o[2],u.ops.push(i);break}o[2]&&u.ops.pop(),u.trys.pop();continue}i=t.call(e,u)}catch(e){i=[6,e],n=0}finally{r=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,a])}}},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var u=i(r(533)),a=r(701),s=r(203),c=function(){function e(){}return e.prototype.signupByEmail=function(e,t){return n(this,void 0,void 0,(function(){var r=this;return o(this,(function(i){switch(i.label){case 0:return[4,s.prisma.$transaction((function(i){return n(r,void 0,void 0,(function(){var r;return o(this,(function(n){switch(n.label){case 0:return[4,i.users.create({data:{nickname:e.value}})];case 1:return r=n.sent(),[4,i.users_auths.create({data:{identity_type:"email",identifier:t.email,credential:t.password,users:{connect:{id:r.id}}}})];case 2:return n.sent(),[2]}}))}))}))];case 1:return i.sent(),[2]}}))}))},e.prototype.loginByEmail=function(e){return n(this,void 0,void 0,(function(){var t;return o(this,(function(r){switch(r.label){case 0:return[4,s.prisma.users_auths.findFirst({where:{identity_type:"email",identifier:e},include:{users:{select:{id:!0}}}})];case 1:return(t=r.sent())?[2,this.createAuthCredential(t.users.id,t.identifier,t.credential)]:[2,t]}}))}))},e.prototype.authByGithub=function(e,t,r){return n(this,void 0,void 0,(function(){var n,i,u;return o(this,(function(o){switch(o.label){case 0:return[4,s.prisma.users_auths.findFirst({where:{identity_type:"github",identifier:t},include:{users:{select:{id:!0}}}})];case 1:return(n=o.sent())?[4,s.prisma.users_auths.update({where:{id:n.id},data:{credential:r}})]:[3,3];case 2:return o.sent(),[2,this.createAuthCredential(n.users.id,n.identifier,r)];case 3:return[4,s.prisma.users.create({data:{nickname:e}})];case 4:return i=o.sent(),console.log(i),[4,s.prisma.users_auths.create({data:{identity_type:"github",identifier:t,credential:r,users:{connect:{id:i.id}}}})];case 5:return u=o.sent(),[2,this.createAuthCredential(i.id,u.identifier,u.credential)]}}))}))},e.prototype.createAuthCredential=function(e,t,r){var n=new a.GeneratedId(e);return new u.default(n,t,r)},e}();t.default=c},571:function(e,t,r){var n=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))((function(o,i){function u(e){try{s(n.next(e))}catch(e){i(e)}}function a(e){try{s(n.throw(e))}catch(e){i(e)}}function s(e){var t;e.done?o(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(u,a)}s((n=n.apply(e,t||[])).next())}))},o=this&&this.__generator||function(e,t){var r,n,o,i,u={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(i){return function(a){return function(i){if(r)throw new TypeError("Generator is already executing.");for(;u;)try{if(r=1,n&&(o=2&i[0]?n.return:i[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,i[1])).done)return o;switch(n=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return u.label++,{value:i[1],done:!1};case 5:u.label++,n=i[1],i=[0];continue;case 7:i=u.ops.pop(),u.trys.pop();continue;default:if(!((o=(o=u.trys).length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){u=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){u.label=i[1];break}if(6===i[0]&&u.label<o[1]){u.label=o[1],o=i;break}if(o&&u.label<o[2]){u.label=o[2],u.ops.push(i);break}o[2]&&u.ops.pop(),u.trys.pop();continue}i=t.call(e,u)}catch(e){i=[6,e],n=0}finally{r=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,a])}}},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var u=i(r(807)),a=i(r(507)),s=i(r(67)),c=r(701),l=r(955),f=r(424);t.default=function(){return{create:function(e,t,r){n(void 0,void 0,void 0,(function(){var r,n,i,s,f,d,p;return o(this,(function(o){switch(o.label){case 0:if(r=null===(p=e.user)||void 0===p?void 0:p.id,n=e.body,i=n.name,s=n.description,!r)throw new u.default("認証に失敗しました",401);return f=a.default.create(new c.GeneratedId(r),i,s),[4,l.projectsRepository.create(f)];case 1:return d=o.sent(),t.status(200).send({id:d.detail.id.value,name:d.detail.name.value,description:d.detail.description.value}),[2]}}))})).catch(r)},fetchById:function(e,t,r){n(void 0,void 0,void 0,(function(){var r,n,i,a,s;return o(this,(function(o){switch(o.label){case 0:if(r=e.params.id,!(n=null===(s=e.user)||void 0===s?void 0:s.id))throw new u.default("認証に失敗しました",401);return i=c.GeneratedId.validate(Number(r)||-1),[4,l.projectsQueryService.fetchById(i.value)];case 1:if(!(a=o.sent()).members.find((function(e){return e.userId===n})))throw new u.default("プロジェクトに参加していません",403);return t.status(200).send({id:a.id,name:a.name,description:a.description,members:a.members}),[2]}}))})).catch(r)},fetchList:function(e,t,r){n(void 0,void 0,void 0,(function(){var r,n,i;return o(this,(function(o){switch(o.label){case 0:if(!(r=null===(i=e.user)||void 0===i?void 0:i.id))throw new u.default("認証に失敗しました",401);return[4,l.projectsQueryService.fetchList(r)];case 1:return n=o.sent(),t.status(200).send({projects:n.map((function(e){return{id:e.id,name:e.name,description:e.description}}))}),[2]}}))})).catch(r)},update:function(e,t,r){n(void 0,void 0,void 0,(function(){var r,n,i,a,d,p,h,_,v,y;return o(this,(function(o){switch(o.label){case 0:if(r=e.params.id,n=null===(y=e.user)||void 0===y?void 0:y.id,i=e.body,a=i.name,d=i.description,!n)throw new u.default("認証に失敗しました",401);return p=c.GeneratedId.validate(Number(r)||-1),[4,l.rolesRepository.fetchRoleId(p,n)];case 1:if(h=o.sent(),!(0,f.checkPermission)(h,"projects:update"))throw new u.default("プロジェクトを更新する権限がありません",403);return _=s.default.create(a,d),v=_.setId(p),[4,l.projectsRepository.update(v)];case 2:return o.sent(),t.status(200).send({id:v.id.value,name:v.name.value,description:v.description.value}),[2]}}))})).catch(r)},remove:function(e,t,r){n(void 0,void 0,void 0,(function(){var r,n,i,a,s;return o(this,(function(o){switch(o.label){case 0:if(r=e.params.id,!(n=null===(s=e.user)||void 0===s?void 0:s.id))throw new u.default("認証に失敗しました",401);return i=c.GeneratedId.validate(Number(r)||-1),[4,l.rolesRepository.fetchRoleId(i,n)];case 1:if(a=o.sent(),!(0,f.checkPermission)(a,"projects:remove"))throw new u.default("プロジェクトを削除する権限がありません",403);return[4,l.projectsRepository.remove(i)];case 2:return o.sent(),t.status(200).end(),[2]}}))})).catch(r)}}}},442:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0});var n=r(701),o=r(424),i=function(){function e(e,t,r){this._projectId=e,this._userId=t,this._role=r}return e.ADMINISTRATOR=function(t){return new e(n.NoneId.instance,t,o.ROLE_LIST.ADMINISTRATOR)},Object.defineProperty(e.prototype,"projectId",{get:function(){return this._projectId},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"userId",{get:function(){return this._userId},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"role",{get:function(){return this._role},enumerable:!1,configurable:!0}),e.prototype.setId=function(t){return new e(t,this._userId,this._role)},e}();t.default=i},507:function(e,t,r){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var o=n(r(442)),i=n(r(67)),u=function(){function e(e,t){this._detail=e,this._members=t}return e.create=function(t,r,n){return new e(i.default.create(r,n),[o.default.ADMINISTRATOR(t)])},Object.defineProperty(e.prototype,"detail",{get:function(){return this._detail},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"members",{get:function(){return this._members},enumerable:!1,configurable:!0}),e.prototype.setId=function(t){return new e(this._detail.setId(t),this._members.map((function(e){return e.setId(t)})))},e.prototype.isMemberExist=function(e){return this._members.some((function(t){return t.userId.equals(e)}))},e.prototype.isMemberFull=function(){return this._members.length>=e.MAX_MEMBERS},e.MAX_MEMBERS=30,e}();t.default=u},67:function(e,t,r){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var o=n(r(104)),i=n(r(342)),u=r(701),a=function(){function e(e,t,r){this._id=e,this._name=t,this._description=r}return e.create=function(t,r){return new e(u.NoneId.instance,i.default.create(t),o.default.create(r))},Object.defineProperty(e.prototype,"id",{get:function(){return this._id},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"name",{get:function(){return this._name},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"description",{get:function(){return this._description},enumerable:!1,configurable:!0}),e.prototype.setId=function(t){return new e(t,this._name,this._description)},e}();t.default=a},104:function(e,t,r){var n,o=this&&this.__extends||(n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])},n(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var u=i(r(596)),a=i(r(807)),s=function(e){function t(t){return e.call(this,t)||this}return o(t,e),t.create=function(e){if(!e)return new t("");if(e.length>255)throw new a.default("プロジェクトの説明は255文字以下で入力してください",400);return new t(e)},t}(u.default);t.default=s},342:function(e,t,r){var n,o=this&&this.__extends||(n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])},n(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var u=i(r(596)),a=i(r(807)),s=function(e){function t(t){return e.call(this,t)||this}return o(t,e),t.create=function(e){if(!e)throw new a.default("プロジェクト名を入力してください",400);if(e.length<3||e.length>255)throw new a.default("プロジェクト名は3文字以上255文字以下で入力してください",400);return new t(e)},t}(u.default);t.default=s},285:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ProjectListItemDTO=t.ProjectDTO=void 0;var r=function(){function e(e,t,r,n){this._id=e,this._name=t,this._description=r,this._members=n,Object.freeze(this)}return Object.defineProperty(e.prototype,"id",{get:function(){return this._id},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"name",{get:function(){return this._name},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"description",{get:function(){return this._description},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"members",{get:function(){return this._members},enumerable:!1,configurable:!0}),e}();t.ProjectDTO=r;var n=function(){function e(e,t,r){this._id=e,this._name=t,this._description=r,Object.freeze(this)}return Object.defineProperty(e.prototype,"id",{get:function(){return this._id},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"name",{get:function(){return this._name},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"description",{get:function(){return this._description},enumerable:!1,configurable:!0}),e}();t.ProjectListItemDTO=n},155:function(e,t,r){var n=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))((function(o,i){function u(e){try{s(n.next(e))}catch(e){i(e)}}function a(e){try{s(n.throw(e))}catch(e){i(e)}}function s(e){var t;e.done?o(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(u,a)}s((n=n.apply(e,t||[])).next())}))},o=this&&this.__generator||function(e,t){var r,n,o,i,u={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(i){return function(a){return function(i){if(r)throw new TypeError("Generator is already executing.");for(;u;)try{if(r=1,n&&(o=2&i[0]?n.return:i[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,i[1])).done)return o;switch(n=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return u.label++,{value:i[1],done:!1};case 5:u.label++,n=i[1],i=[0];continue;case 7:i=u.ops.pop(),u.trys.pop();continue;default:if(!((o=(o=u.trys).length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){u=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){u.label=i[1];break}if(6===i[0]&&u.label<o[1]){u.label=o[1],o=i;break}if(o&&u.label<o[2]){u.label=o[2],u.ops.push(i);break}o[2]&&u.ops.pop(),u.trys.pop();continue}i=t.call(e,u)}catch(e){i=[6,e],n=0}finally{r=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,a])}}},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var u=i(r(807)),a=r(203),s=r(285),c=function(){function e(){}return e.prototype.fetchList=function(e){return n(this,void 0,void 0,(function(){return o(this,(function(t){switch(t.label){case 0:return[4,a.prisma.projects.findMany({where:{delete_flag:!1,projects_members:{some:{user_id:e,delete_flag:!1}}},orderBy:{updated_at:"desc"}})];case 1:return[2,t.sent().map((function(e){return new s.ProjectListItemDTO(e.id,e.name,e.description)}))]}}))}))},e.prototype.fetchById=function(e){return n(this,void 0,void 0,(function(){var t,r;return o(this,(function(n){switch(n.label){case 0:return[4,a.prisma.projects.findFirst({where:{id:e,delete_flag:!1},include:{projects_members:{where:{delete_flag:!1},include:{users:!0,roles:!0}}}})];case 1:if(!(t=n.sent()))throw new u.default("プロジェクトが存在しません",404);return r=t.projects_members.map((function(e){return{userId:e.user_id,name:e.users.nickname,role:{id:e.roles.id,name:e.roles.name}}})),[2,new s.ProjectDTO(t.id,t.name,t.description,r)]}}))}))},e}();t.default=c},463:function(e,t,r){var n=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))((function(o,i){function u(e){try{s(n.next(e))}catch(e){i(e)}}function a(e){try{s(n.throw(e))}catch(e){i(e)}}function s(e){var t;e.done?o(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(u,a)}s((n=n.apply(e,t||[])).next())}))},o=this&&this.__generator||function(e,t){var r,n,o,i,u={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(i){return function(a){return function(i){if(r)throw new TypeError("Generator is already executing.");for(;u;)try{if(r=1,n&&(o=2&i[0]?n.return:i[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,i[1])).done)return o;switch(n=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return u.label++,{value:i[1],done:!1};case 5:u.label++,n=i[1],i=[0];continue;case 7:i=u.ops.pop(),u.trys.pop();continue;default:if(!((o=(o=u.trys).length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){u=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){u.label=i[1];break}if(6===i[0]&&u.label<o[1]){u.label=o[1],o=i;break}if(o&&u.label<o[2]){u.label=o[2],u.ops.push(i);break}o[2]&&u.ops.pop(),u.trys.pop();continue}i=t.call(e,u)}catch(e){i=[6,e],n=0}finally{r=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,a])}}},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var u=i(r(807)),a=r(701),s=r(203),c=r(747),l=function(){function e(){}return e.prototype.create=function(e){return n(this,void 0,void 0,(function(){var t,r,i,l=this;return o(this,(function(f){switch(f.label){case 0:if(!(t=e.members[0]))throw new u.default("プロジェクトのオーナーが存在しません",400);return[4,s.prisma.$transaction((function(r){return n(l,void 0,void 0,(function(){return o(this,(function(n){switch(n.label){case 0:return[4,r.projects.create({data:{name:e.detail.name.value,description:e.detail.description.value,updated_at:(0,c.now)(),projects_members:{create:{user_id:t.userId.value,role_id:t.role.id}}}})];case 1:return[2,n.sent()]}}))}))}))];case 1:return r=f.sent(),i=new a.GeneratedId(r.id),[2,e.setId(i)]}}))}))},e.prototype.update=function(e){return n(this,void 0,void 0,(function(){return o(this,(function(t){switch(t.label){case 0:return[4,s.prisma.projects.update({where:{id:e.id.value},data:{name:e.name.value,description:e.description.value,updated_at:(0,c.now)()}})];case 1:return t.sent(),[2]}}))}))},e.prototype.remove=function(e){return n(this,void 0,void 0,(function(){return o(this,(function(t){switch(t.label){case 0:return[4,s.prisma.projects.update({where:{id:e.value},data:{delete_flag:!0}})];case 1:return t.sent(),[2]}}))}))},e}();t.default=l},874:function(e,t,r){var n=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))((function(o,i){function u(e){try{s(n.next(e))}catch(e){i(e)}}function a(e){try{s(n.throw(e))}catch(e){i(e)}}function s(e){var t;e.done?o(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(u,a)}s((n=n.apply(e,t||[])).next())}))},o=this&&this.__generator||function(e,t){var r,n,o,i,u={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(i){return function(a){return function(i){if(r)throw new TypeError("Generator is already executing.");for(;u;)try{if(r=1,n&&(o=2&i[0]?n.return:i[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,i[1])).done)return o;switch(n=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return u.label++,{value:i[1],done:!1};case 5:u.label++,n=i[1],i=[0];continue;case 7:i=u.ops.pop(),u.trys.pop();continue;default:if(!((o=(o=u.trys).length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){u=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){u.label=i[1];break}if(6===i[0]&&u.label<o[1]){u.label=o[1],o=i;break}if(o&&u.label<o[2]){u.label=o[2],u.ops.push(i);break}o[2]&&u.ops.pop(),u.trys.pop();continue}i=t.call(e,u)}catch(e){i=[6,e],n=0}finally{r=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,a])}}},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var u=i(r(807)),a=r(203),s=function(){function e(){}return e.prototype.fetchRoleId=function(e,t){return n(this,void 0,void 0,(function(){var r;return o(this,(function(n){switch(n.label){case 0:return[4,a.prisma.projects.findFirst({where:{id:e.value,delete_flag:!1}})];case 1:if(!n.sent())throw new u.default("プロジェクトが存在しません",404);return[4,a.prisma.projects_members.findFirst({where:{project_id:e.value,user_id:t,delete_flag:!1}})];case 2:if(!(r=n.sent()))throw new u.default("プロジェクトに参加していません",403);return[2,r.role_id]}}))}))},e}();t.default=s},701:function(e,t,r){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.NoneId=t.GeneratedId=void 0;var o=n(r(807)),i=function(){function e(e){this.isGenerated=!0,this._value=e,Object.freeze(this)}return e.validate=function(t){if(t<1||!Number.isInteger(t))throw new o.default("IDは1以上の整数で入力してください",400);return new e(t)},Object.defineProperty(e.prototype,"value",{get:function(){return this._value},enumerable:!1,configurable:!0}),e.prototype.equals=function(e){return this.value===e.value},e}();t.GeneratedId=i;var u=function(){function e(){this.isGenerated=!1}return Object.defineProperty(e.prototype,"value",{get:function(){throw new o.default("IDが生成されていません",400)},enumerable:!1,configurable:!0}),e.instance=new e,e}();t.NoneId=u},596:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e){this._value=e,Object.freeze(this)}return Object.defineProperty(e.prototype,"value",{get:function(){return this._value},enumerable:!1,configurable:!0}),e.prototype.equals=function(e){return this.constructor.name===e.constructor.name&&this._value===e.value},e}();t.default=r},203:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.prisma=void 0;var n=r(524);t.prisma=new n.PrismaClient},39:function(e,t,r){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),r(236);var o=n(r(280)),i=r(55),u=o.default.server.port;i.listen(u,(function(){console.log("Server listening on port ".concat(u))}))},635:function(e,t,r){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var o=n(r(527)),i=n(r(565));t.default=function(e){e.use((function(e,t,r,n){var u=e.status||500,a=new o.default;i.default.error(e.message),r.status(u).send(a.error(e))}))}},919:function(e,t,r){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.authRouter=void 0;var o=n(r(402)),i=n(r(536));t.authRouter=function(e){var t=e.Router(),r=(0,i.default)();return t.post("/auth/signup",r.signup),t.post("/auth/login",o.default.authenticate("local",{session:!1,scope:["user:email"]}),r.login),t.get("/auth/github",o.default.authenticate("github",{session:!1})),t.get("/auth/github/callback",o.default.authenticate("github",{session:!1}),r.login),t}},736:function(e,t,r){var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var o=Object.getOwnPropertyDescriptor(t,r);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,o)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),o=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||n(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),o(r(919),t),o(r(115),t)},115:function(e,t,r){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.projectsRouter=void 0;var o=n(r(402)),i=n(r(571));t.projectsRouter=function(e){var t=e.Router(),r=(0,i.default)();return t.route("/projects").get(o.default.authenticate("jwt",{session:!1}),r.fetchList).post(o.default.authenticate("jwt",{session:!1}),r.create),t.route("/projects/:id").get(o.default.authenticate("jwt",{session:!1}),r.fetchById).put(o.default.authenticate("jwt",{session:!1}),r.update).delete(o.default.authenticate("jwt",{session:!1}),r.remove),t}},55:function(e,t,r){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var o=n(r(582)),i=n(r(685)),u=n(r(860)),a=n(r(280)),s=n(r(635)),c=n(r(402)),l=r(736),f=(0,u.default)(),d=i.default.createServer(f);f.use(u.default.json()),f.use(u.default.urlencoded({extended:!1}));var p={origin:a.default.server.cors.origin,optionsSuccessStatus:200};f.use((0,o.default)(p)),f.use(c.default.initialize()),f.use("/api/v1",(0,l.authRouter)(u.default),(0,l.projectsRouter)(u.default)),(0,s.default)(f),e.exports=d},747:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.now=void 0,t.now=function(){return new Date((new Date).toLocaleString("ja-JP",{timeZone:"Asia/Tokyo"}))}},807:function(e,t){var r,n=this&&this.__extends||(r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])},r(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=function(e){function t(t,r){void 0===r&&(r=500);var n=e.call(this,t)||this;return n.message=t,n.status=r,n}return n(t,e),t}(Error);t.default=o},482:function(e,t,r){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.compareSync=t.hashSync=void 0;var o=n(r(96));t.hashSync=function(e){return o.default.hashSync(e,10)},t.compareSync=function(e,t){return o.default.compareSync(e,t)}},818:function(e,t,r){var n,o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.signToken=t.JWT_SECRET_KEY=void 0;var i=o(r(344));t.JWT_SECRET_KEY=null!==(n=process.env.JWT_SECRET_KEY)&&void 0!==n?n:"MY_SECRET_KEY",t.signToken=function(e,r){return i.default.sign(e,t.JWT_SECRET_KEY,r)}},565:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0});var n=r(42);t.default=n.logger},42:function(e,t,r){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.logger=void 0;var o=n(r(773));t.logger=o.default.createLogger({level:"info",format:o.default.format.json(),defaultMeta:{service:"user-service"},transports:[new o.default.transports.File({filename:"logs/error.log",level:"error"}),new o.default.transports.File({filename:"logs/combined.log"})]})},527:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(){}return e.prototype.error=function(e){return{message:e.message}},e}();t.default=r},424:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.checkPermission=t.getRole=t.rules=t.ROLE_LIST=void 0,t.ROLE_LIST={ADMINISTRATOR:{id:1,name:"管理者"},LEADER:{id:4,name:"リーダー"},DEVELOPER:{id:3,name:"開発者"},CLIENT:{id:2,name:"クライアント"}},t.rules={ADMINISTRATOR:{static:["projects:update","projects:remove"],dynamic:{}},LEADER:{static:["projects:update"],dynamic:{}},DEVELOPER:{static:[],dynamic:{}},CLIENT:{static:[],dynamic:{}}},t.getRole=function(e){return Object.values(t.ROLE_LIST).find((function(t){return t.id===e}))},t.checkPermission=function(e,r,n){var o=Object.keys(t.ROLE_LIST).find((function(r){return t.ROLE_LIST[r].id===e}));if(void 0===o)return!1;if(t.rules[o].static.includes(r))return!0;var i=t.rules[o].dynamic[r];return!(!i||!n)&&i(n)}},524:e=>{e.exports=require("@prisma/client")},96:e=>{e.exports=require("bcrypt")},582:e=>{e.exports=require("cors")},860:e=>{e.exports=require("express")},344:e=>{e.exports=require("jsonwebtoken")},511:e=>{e.exports=require("passport")},253:e=>{e.exports=require("passport-github2")},136:e=>{e.exports=require("passport-jwt")},518:e=>{e.exports=require("passport-local")},236:e=>{e.exports=require("reflect-metadata")},896:e=>{e.exports=require("tsyringe")},773:e=>{e.exports=require("winston")},685:e=>{e.exports=require("http")}},t={};!function r(n){var o=t[n];if(void 0!==o)return o.exports;var i=t[n]={exports:{}};return e[n].call(i.exports,i,i.exports,r),i.exports}(39)})();